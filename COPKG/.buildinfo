#product-info  {
	product-name: "libxml2";
	version: "2.7.8";
	original-source-location: "git://git.gnome.org/libxml2";
	original-source-website: "http://git.gnome.org/browse/libxml2/";
	license: "X11 license";
	packager: "Vincent Povirk <madewokherd@gmail.com>";
}


x86 {
    compiler: vc10;

    uses:mingw=@"..\libiconv";
    uses:x86=@"..\zlib";
    
    targets: {
		"win32\bin.msvc\libxml2.dll",
		"win32\bin.msvc\libxml2.lib",
		"win32\bin.msvc\libxml2_a.lib",
		"win32\bin.msvc\libxml2_a_dll.lib",
		"win32\bin.msvc\xmlcatalog.exe",
		"win32\bin.msvc\xmllint.exe",
	};
	
    build-command:@"
        cd win32
		cscript configure.js zlib=yes include=../../libiconv/include;../../zlib lib=../../libiconv/lib/.libs;../../zlib/contrib/vstudio/vc10/x86/ZlibDllRelease
		nmake /f Makefile.msvc
	";
    
    clean-command:@"
		rem We can't do a make clean because it'll fail without configure.
		erase config.h > nul 2> nul
		erase include\libxml\xmlversion.h > nul 2> nul
		erase win32\Makefile > nul 2> nul
		erase win32\config.msvc > nul 2> nul
        if exist win32\bin.msvc rmdir /s /q win32\bin.msvc > nul 2> nul
        if exist win32\int.a.dll.msvc rmdir /s /q win32\int.a.dll.msvc > nul 2> nul
        if exist win32\int.a.msvc rmdir /s /q win32\int.a.msvc > nul 2> nul
        if exist win32\int.msvc rmdir /s /q win32\int.msvc > nul 2> nul
        if exist win32\int.utils.msvc rmdir /s /q win32\int.utils.msvc > nul 2> nul
    ";
};

x86-vc {
    compiler: vc10;
    platform: x86;

    uses:x86=@"..\libiconv";
    uses:x86=@"..\zlib";
    
    targets: {
		"win32\bin.msvc\libxml2.dll",
		"win32\bin.msvc\libxml2.lib",
		"win32\bin.msvc\libxml2_a.lib",
		"win32\bin.msvc\libxml2_a_dll.lib",
		"win32\bin.msvc\xmlcatalog.exe",
		"win32\bin.msvc\xmllint.exe",
	};
	
    build-command:@"
        cd win32
		cscript configure.js zlib=yes include=../../libiconv/include;../../zlib lib=../../libiconv/Release/win32;../../zlib/contrib/vstudio/vc10/x86/ZlibDllRelease
		nmake /f Makefile.msvc
	";
    
    clean-command:@"
		rem We can't do a make clean because it'll fail without configure.
		erase config.h > nul 2> nul
		erase include\libxml\xmlversion.h > nul 2> nul
		erase win32\Makefile > nul 2> nul
		erase win32\config.msvc > nul 2> nul
        if exist win32\bin.msvc rmdir /s /q win32\bin.msvc > nul 2> nul
        if exist win32\int.a.dll.msvc rmdir /s /q win32\int.a.dll.msvc > nul 2> nul
        if exist win32\int.a.msvc rmdir /s /q win32\int.a.msvc > nul 2> nul
        if exist win32\int.msvc rmdir /s /q win32\int.msvc > nul 2> nul
        if exist win32\int.utils.msvc rmdir /s /q win32\int.utils.msvc > nul 2> nul
    ";
};

x64-vc {
    compiler: vc10;
    platform: x64;

    uses:x64=@"..\libiconv";
    uses:x64=@"..\zlib";
    
    targets: {
		"x64\bin.msvc\libxml2.dll",
		"x64\bin.msvc\libxml2.lib",
		"x64\bin.msvc\libxml2_a.lib",
		"x64\bin.msvc\libxml2_a_dll.lib",
		"x64\bin.msvc\xmlcatalog.exe",
		"x64\bin.msvc\xmllint.exe",
	};
	
    build-command:@"
           mkdir x64
           copy win32\wince x64\wince
           copy win32\configure.js x64\configure.js 
           copy win32\defgen.xsl x64\defgen.xsl 
           copy win32\libxml2.def.src x64\libxml2.def.src 
           copy win32\Makefile.msvc x64\Makefile.msvc

           cd x64
		cscript configure.js zlib=yes include=../../libiconv/include;../../zlib lib=../../libiconv/Release/x64;../../zlib/contrib/vstudio/vc10/x64/ZlibDllRelease
		nmake /f Makefile.msvc
	";
    
    clean-command:@"
		rem We can't do a make clean because it'll fail without configure.
		erase config.h > nul 2> nul
		erase include\libxml\xmlversion.h > nul 2> nul
        if exist x64 rmdir /s /q x64 > nul 2> nul
    ";
};

